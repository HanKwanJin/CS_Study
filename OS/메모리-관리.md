# 메모리 관리 
## 가상 메모리 virtual memory
컴퓨터가 실제로 이용 가능한 메모리 자원을 추상화하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 것
![image](https://velog.velcdn.com/images/developer-sora/post/29194bfb-4ed3-4321-ab28-d543dfe99ea4/image.png)
가상으로 주어진 주소를 가상 주소(논리 주소)라고 하며, 실제 메모리상에 있는 주소를 실제 주소(물리 주소)라고 한다.

가상 주소는 메모리관리장치(MMU)에 의해 실제 주소로 변환되며, 이 덕분에 사용자는 실제 주소를 의식할 필요 없이 프로그램을 구축할수 있다.

가상 메모리는 **페이지 테이블**로 관리 되며, 속도 향상을 위해 **TLB**를 사용한다.

### **스와핑**
가상 메모리에는 존재하지만 실제 메모리인 RAM에는 없는 데이터나 코드에 접근 할 경우 페이지 폴트가 발생하는데, 이 때 메모리에서 당장 사용하지 않는 영역을 하드디스크로 옮기고 하드디스크의 일부분으르 마치 메모리처럼 불러와 쓰는 것을 스와핑(swapping)이라고 한다.

- 페이지 폴트란? 
<br> 프로세스의 주소 공간에는 존재하지만 지금 이 컴퓨터의 RAM에는 없는 데이터에 접근했을 경우 발생하는 것 

<br>

## 스레싱 thrashing
스레싱은 메모리의 페이지 폴트율이 높은 것을 의미한다.
이는 컴퓨터의 심각한 성능 저하를 초래하기 때문에 이를 해결하기 위한 방법으로는 메모리를 늘리거나, HDD를 SSD로 바꾸는 방법이 있다.
운영체제에서 이를 해결할 수 있는 방법은 **작업 세트**와 **PFF**가 있다.

### **작업 세트**
작업 세트는 프로세스의 과거 사용 이력인 지역성을 통해 결정된 페이지 집합을 만들어서 미리 메모리에 로드하는 것이다. 미리 메모리에 로드하면 탐색에 드는 비용을 줄일 수 있고 스와핑 또한 줄일 수 있다.

### **PFF**
PFF(Page Fault Frequency)는 페이지 폴트 빈도를 조절하는 방법으로 상한선에 도달하면 프레임을 늘리고 하한선에 도달하면 프레임을 줄이는 것이다.


<br>

## 메모리 할당
메모리에 프로그램을 할당할 때는 시작 메모리 위치, 메모리의 할당 크기를 기반으로 할당하는데, 연속 할당과 불연속 할당으로 나뉜다.

### **연속 할당**
연속 할당은 메모리에 연속적으로 공간을 할당하는 것을 말한다.
![img](https://velog.velcdn.com/images/developer-sora/post/6943726d-da76-43e2-95f9-0da28147f0c5/image.png)

### **고정 분할 방식**
고정 분할 방식은 메모리를 미리 나누어 관리하는 방식이며, 내부 단편화가 발생한다.

### **가변 분할 방식**
가별 분할 방식은 매 시점 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용하는 방식으로, 외부 단편화가 발생할 수 있다.
- 최초적합: 위쪽이나 아래쪽에서부터 시작해서 홀을 찾으면 바로 할당
- 최적접합: 프로세스의 크기 이상인 공간 중 가장 작은 홀부터 할당
- 최악접합: 프로세스의 크기와 가장 많이 차이가 나는 홀에 할당

### **불연속 할당**
- 페이징
<br>
동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 프로세스를 할당하는 것을 말한다. 홀의 크기가 균일하지만 주소 변환이 복잡해진다.

- 세그멘테이션
<br>
세그멘테이션은 페이지 단위가 아닌 의미 단위인 세그먼트(segment)로 나누는 방식을 말한다. 공유와 보안 측면에서 좋지만 홀 크기가 균일하지 않은 문제가 발생된다.

- 페이지드 세그멘테이션
<br>
페이지드 세그멘테이션은 공유나 보안을 의미 단위의 세그먼트로 나누고, 물리적 메모리는 페이지로 나누는 것을 말한다.

<br>


## 페이지 교체 알고리즘
페이지 교체 알고리즘을 기반으로 스와핑이 일어나기 때문에 스와핑이 많이 일어나지 않도록 설계되어야 한다.

- 오프라인 알고리즘
<br>
오프라인 알고리즘은 먼 미래에 참조되는 페이지와 현재 할당하는 페이지를 바꾸는 알고리즘이며, 다른 알고리즘과의 성능 비교에 대한 기준을 제공한다.

- FIFO(First In First Out)
<br>
가장 먼저 온 페이지를 교체 영역에 가장 먼저 놓는 방법.

- LRU(Least Recentle Used)
<br>
참조가 가장 오래된 페이지를 바꾸는 것.

- NUR(Not Used Recently)
<br>
LRU에서 발전한 알고리즘으로 clock 알고리즘이라고도 하며 시계방향으로 돌면서 0비트를 찾고 0을 찾은 순간 해당 프로세스를 교체하고 해당 부분을 1로 바꾸는 알고리즘이다.

- LFU(Least Frequently Used)
<br>
가장 참조 횟수가 적은 페이지를 교체하는 것.
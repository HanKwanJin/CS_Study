## 관계

데이터베이스에서는 두 개의 엔티티간의 관계를 정의해야 한다. <br>
관계를 표기하기 위해서는 몇가지 개념을 알고 있어야한다.

1. 관계명 : 관계의 이름 <br>
![image](https://user-images.githubusercontent.com/49395754/222460817-47287a2f-c7c3-415c-83a6-06fc70801420.png) <br>
   관계명이란 엔티티가 관계에 참여하는 형태를 지칭하는 이름으로, 두 개의 엔티티에 대한 것이기 때문에 하나의 관계는 2개의 현재형으로 표현한 관계명을 가진다.
2. 관계 차수 <br>
   두 개의 엔티티 관계에서 참여자의 수를 표현하는 것을 관계차수라고 한다. 가장 일반적인 관계차수 표현방법은 1:1, 1:N, N:N이다.
3. 관계 선택 사양 <br>
    관계에서 항상 참여해야 하는지(필수관계인지) 아니면 참여할 수도 있는지(선택관계인지)에 대한 것을 관계 선택 사양이라고 한다. <br >
<img src="https://user-images.githubusercontent.com/49395754/222461289-0c77334f-03ff-48e4-a233-372b3e973ff1.png" width="500" height="200"> <br>

    * 학생은 수업을 들을 수도있고 안들을 수도 있다.
    * 학생 엔티티를 기준으로 학생-수업 관계는 선택 참여이다.
    * 학생이 듣지 않는 수업은 존재할 수 없다.
    * 수업 엔티티는 학생 엔티티와의 관계가 필수적이기 때문에 수업 엔티티를 기준으로 수업-학생 관계는 필수 참여가 된다.

<br>

## 테이블 관계

### 1 : 1 (일대일 관계)
![image](https://user-images.githubusercontent.com/49395754/222463489-07c7bd2c-414d-49ad-bcfb-f13308fc8f14.png) <br>
1 : 1 관계란 참조하는 테이블의 row와 참조되는 table의 row가 단 하나의 관계를 가지는 것을 의미한다.
* Users 테이블과 Phonebook 테이블이 있다고 가정한다.
* Users 테이블은 ID, name, phone_id를 가지고 있다.
* 이 중 phone_id는 외래키(foreign key)로써, Phonebook 테이블의 ID 와 연결되어 있다.
* 각 전화번호가 단 한 명의 유저와 연결되어 있고 그 반대도 동일하다면, Users 테이블과 Phonebook 테이블은 1:1 관계(One-to-one relationship)이다.

<br>

### 1 : N 관계
![image](https://user-images.githubusercontent.com/49395754/222464937-d8b17538-21f3-4a1a-80cb-981c677c1c2d.png)
하나의 레코드가 서로 다른 여러 개의 레코드와 연결된 경우이다.
* Users 테이블과 Phonebook 테이블의 관계를 다음과 같이 가정한다.
* 이 구조에서는 한 명의 유저가 여러 전화번호를 가질 수 있다.
* 그러나 여러명의 유저가 하나의 전화번호를 가질 수는 없다.
* 이런 1:N(일대다) 관계는 관계형 데이터베이스에서 가장 많이 사용한다.

<br>

### N:M 관계
여러 개의 레코드가 다른 테이블의 여러 개의 레코드와 관계가 있는 경우이다.
![image](https://user-images.githubusercontent.com/49395754/222465628-ce0cfd3d-36c5-4770-bd57-85427d3007d1.png)

* N:M(다대다) 관계를 위해 스키마를 디자인할 때에는, Join 테이블을 만들어 관리한다.
* 위에 처럼 customer과 package 테이블이 있다고 가정해보자.
* 고객 한 명은 여러개의 여행 상품을 구매할 수 있다. 여행 상품 하나는 여러 명의 고객이 구매할 수 있다.
* 이러면 다대다 관계가 성립한다.
* 이 모양은 두 개의 일대다 관계와 그 모양이 같다. 
* 두 개의 테이블과 1:N(일대다) 관계를 형성하는 새로운 테이블로 N:M(다대다) 관계를 나타낼 수 있다.

![image](https://user-images.githubusercontent.com/49395754/222466285-bdaacde1-bc53-409e-a926-02a83805b65f.png)
* customer_package 테이블에서는 고객 한 명이 여러 개의 여행 상품을 가질 수 있고, 여행 상품 하나가 여러 개의 고객을 가질 수 있다.
*  조인 테이블을 생성하더라도, 조인 테이블을 위한 기본키(여기서는 ID)는 반드시 있어야 한다.

### 만약 조인 테이블이 없다면 생기는 문제????

1. 데이터를 조회하는데 많은 비용이 발생하게 된다.
2. 데이터를 수정할 때 두 곳에 수정이 잘 되었는지 확인이 불편하다.
3. 필드에 저장되는 데이터의 크기를 설정해야하는데 엄청 커지게 되고 데이터가 저장되지 못할 수 도 있다.

<br>

### 자기참조 관계(Self Referencing Relationship)
![image](https://user-images.githubusercontent.com/49395754/222467033-064cb2bd-c990-4348-81e9-4cb9b438fd10.png)
* 자기 자신을 참조하는 관계이다.
* 만약 추천인이 누군지 파악하기 위해서 자신의 테이블을 참조할 수 있다.
* 한 명의 유저(user_id)는 한 명의 추천인(recommend_id)를 가질 수 있다.
*  그러나 여러 명이 한 명의 유저를 추천인으로 등록할 수 있다.
* 이 관계는 1:N(일대다) 관계와 유사하다고 생각할 수 있다.
* 하지만 일대단 관계는 서로 다른 테이블의 관계를 나타낼 때 표현하는 방법이다.